{"version":3,"sources":["../../src/services/index.js"],"names":["Thingy","require","insertIntoMongo","ref","enabled","data","INTERVAL","console","log","onTemperatureData","temperature","_id","usersRef","push","set","onPressureData","pressure","onHumidityData","humidity","onGasData","gas","eco2","tvoc","onColorData","color","onRotationNotif","rotation","onStepCounterNotif","steps","onHeadingNotif","heading","onButtonChange","state","temperature_disable","error","pressure_disable","humidity_disable","color_disable","gas_disable","temperature_enable","pressure_enable","humidity_enable","color_enable","gas_enable","startSensors","thingy","on","temperature_interval_set","pressure_interval_set","humidity_interval_set","color_interval_set","gas_mode_set","stepCounter_interval_set","button_enable","rotation_enable","heading_enable","stepCounter_enable","thingyServices","start","bind","module","exports"],"mappings":";;AAAA,IAAIA,MAAM,GAAGC,OAAO,CAAC,UAAD,CAApB;;AACA,IAAIC,eAAe,GAAGD,OAAO,CAAC,SAAD,CAA7B;;AACA,IAAIE,GAAG,GAAGF,OAAO,CAAC,YAAD,CAAjB;;AACA,IAAIG,OAAJ;AACA,IAAIC,IAAI,GAAG,EAAX;AACA,IAAIC,QAAQ,GAAG,IAAf;AACAC,OAAO,CAACC,GAAR,CAAY,qCAAZ;;AAEA,SAASC,iBAAT,CAA2BC,WAA3B,EAAwC;AACpC;AACAL,EAAAA,IAAI,CAACK,WAAL,GAAmBA,WAAnB;AACAL,EAAAA,IAAI,CAACM,GAAL,IAAY,OAAON,IAAI,CAAC,KAAD,CAAvB;AACAH,EAAAA,eAAe,CAACG,IAAD,CAAf;AACA,MAAMO,QAAQ,GAAGT,GAAG,CAACU,IAAJ,EAAjB;AACAD,EAAAA,QAAQ,CAACE,GAAT,CAAaT,IAAb;AACH;;AAED,SAASU,cAAT,CAAwBC,QAAxB,EAAkC;AAC9B;AACAX,EAAAA,IAAI,CAACW,QAAL,GAAgBA,QAAhB;AACH;;AAED,SAASC,cAAT,CAAwBC,QAAxB,EAAkC;AAC9B;AACAb,EAAAA,IAAI,CAACa,QAAL,GAAgBA,QAAhB;AACH;;AAED,SAASC,SAAT,CAAmBC,GAAnB,EAAwB;AACpB;AACAf,EAAAA,IAAI,CAACgB,IAAL,GAAYD,GAAG,CAACC,IAAhB;AACAhB,EAAAA,IAAI,CAACiB,IAAL,GAAYF,GAAG,CAACE,IAAhB;AACH;;AAED,SAASC,WAAT,CAAqBC,KAArB,EAA4B;AACxB;;;;AAIAnB,EAAAA,IAAI,CAACmB,KAAL,GAAaA,KAAb;AACH;;AAED,SAASC,eAAT,CAAyBC,QAAzB,EAAmC;AAC/BrB,EAAAA,IAAI,CAACqB,QAAL,GAAgBA,QAAhB;AACH;;AAED,SAASC,kBAAT,CAA4BC,KAA5B,EAAmC;AAC/BvB,EAAAA,IAAI,CAACuB,KAAL,GAAaA,KAAb;AACArB,EAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ;AACH;;AAED,SAASqB,cAAT,CAAwBC,OAAxB,EAAiC;AAC7BzB,EAAAA,IAAI,CAACyB,OAAL,GAAeA,OAAf;AACH;;AAED,SAASC,cAAT,CAAwBC,KAAxB,EAA+B;AAC3B,MAAIA,KAAK,IAAI,SAAb,EAAwB;AACpB,QAAI5B,OAAJ,EAAa;AACTA,MAAAA,OAAO,GAAG,KAAV;AACA,WAAK6B,mBAAL,CAAyB,UAAUC,KAAV,EAAiB;AACtC3B,QAAAA,OAAO,CAACC,GAAR,CAAY,kCAAmC0B,KAAD,GAAUA,KAAV,GAAkB,EAApD,CAAZ;AACH,OAFD;AAGA,WAAKC,gBAAL,CAAsB,UAAUD,KAAV,EAAiB;AACnC3B,QAAAA,OAAO,CAACC,GAAR,CAAY,+BAAgC0B,KAAD,GAAUA,KAAV,GAAkB,EAAjD,CAAZ;AACH,OAFD;AAGA,WAAKE,gBAAL,CAAsB,UAAUF,KAAV,EAAiB;AACnC3B,QAAAA,OAAO,CAACC,GAAR,CAAY,+BAAgC0B,KAAD,GAAUA,KAAV,GAAkB,EAAjD,CAAZ;AACH,OAFD;AAGA,WAAKG,aAAL,CAAmB,UAAUH,KAAV,EAAiB;AAChC3B,QAAAA,OAAO,CAACC,GAAR,CAAY,4BAA6B0B,KAAD,GAAUA,KAAV,GAAkB,EAA9C,CAAZ;AACH,OAFD;AAGA,WAAKI,WAAL,CAAiB,UAAUJ,KAAV,EAAiB;AAC9B3B,QAAAA,OAAO,CAACC,GAAR,CAAY,0BAA2B0B,KAAD,GAAUA,KAAV,GAAkB,EAA5C,CAAZ;AACH,OAFD;AAGH,KAjBD,MAiBO;AACH9B,MAAAA,OAAO,GAAG,IAAV;AACA,WAAKmC,kBAAL,CAAwB,UAAUL,KAAV,EAAiB;AACrC3B,QAAAA,OAAO,CAACC,GAAR,CAAY,kCAAmC0B,KAAD,GAAUA,KAAV,GAAkB,EAApD,CAAZ;AACH,OAFD;AAGA,WAAKM,eAAL,CAAqB,UAAUN,KAAV,EAAiB;AAClC3B,QAAAA,OAAO,CAACC,GAAR,CAAY,+BAAgC0B,KAAD,GAAUA,KAAV,GAAkB,EAAjD,CAAZ;AACH,OAFD;AAGA,WAAKO,eAAL,CAAqB,UAAUP,KAAV,EAAiB;AAClC3B,QAAAA,OAAO,CAACC,GAAR,CAAY,+BAAgC0B,KAAD,GAAUA,KAAV,GAAkB,EAAjD,CAAZ;AACH,OAFD;AAGA,WAAKQ,YAAL,CAAkB,UAAUR,KAAV,EAAiB;AAC/B3B,QAAAA,OAAO,CAACC,GAAR,CAAY,4BAA6B0B,KAAD,GAAUA,KAAV,GAAkB,EAA9C,CAAZ;AACH,OAFD;AAGA,WAAKS,UAAL,CAAgB,UAAUT,KAAV,EAAiB;AAC7B3B,QAAAA,OAAO,CAACC,GAAR,CAAY,0BAA2B0B,KAAD,GAAUA,KAAV,GAAkB,EAA5C,CAAZ;AACH,OAFD;AAGH;AACJ;AACJ;;AAED,SAASU,YAAT,CAAsBC,MAAtB,EAA8B;AAC1BtC,EAAAA,OAAO,CAACC,GAAR,CAAY,iBAAiBqC,MAA7B;AAEAA,EAAAA,MAAM,CAACC,EAAP,CAAU,YAAV,EAAwB,YAAY;AAChCvC,IAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ;AACH,GAFD;AAKAqC,EAAAA,MAAM,CAACC,EAAP,CAAU,kBAAV,EAA8BrC,iBAA9B;AACAoC,EAAAA,MAAM,CAACC,EAAP,CAAU,eAAV,EAA2B/B,cAA3B;AACA8B,EAAAA,MAAM,CAACC,EAAP,CAAU,eAAV,EAA2B7B,cAA3B;AACA4B,EAAAA,MAAM,CAACC,EAAP,CAAU,UAAV,EAAsB3B,SAAtB;AACA0B,EAAAA,MAAM,CAACC,EAAP,CAAU,YAAV,EAAwBvB,WAAxB;AACAsB,EAAAA,MAAM,CAACC,EAAP,CAAU,aAAV,EAAyBf,cAAzB;AACAc,EAAAA,MAAM,CAACC,EAAP,CAAU,eAAV,EAA2BrB,eAA3B;AACAoB,EAAAA,MAAM,CAACC,EAAP,CAAU,kBAAV,EAA8BnB,kBAA9B;AACAkB,EAAAA,MAAM,CAACC,EAAP,CAAU,cAAV,EAA0BjB,cAA1B;AAEAgB,EAAAA,MAAM,CAACE,wBAAP,CAAgCzC,QAAhC,EAA0C,UAAU4B,KAAV,EAAiB;AACvD,QAAIA,KAAJ,EAAW;AACP3B,MAAAA,OAAO,CAACC,GAAR,CAAY,mCAAmC0B,KAA/C;AACH;AACJ,GAJD;AAKAW,EAAAA,MAAM,CAACG,qBAAP,CAA6B1C,QAA7B,EAAuC,UAAU4B,KAAV,EAAiB;AACpD,QAAIA,KAAJ,EAAW;AACP3B,MAAAA,OAAO,CAACC,GAAR,CAAY,gCAAgC0B,KAA5C;AACH;AACJ,GAJD;AAKAW,EAAAA,MAAM,CAACI,qBAAP,CAA6B3C,QAA7B,EAAuC,UAAU4B,KAAV,EAAiB;AACpD,QAAIA,KAAJ,EAAW;AACP3B,MAAAA,OAAO,CAACC,GAAR,CAAY,gCAAgC0B,KAA5C;AACH;AACJ,GAJD;AAKAW,EAAAA,MAAM,CAACK,kBAAP,CAA0B5C,QAA1B,EAAoC,UAAU4B,KAAV,EAAiB;AACjD,QAAIA,KAAJ,EAAW;AACP3B,MAAAA,OAAO,CAACC,GAAR,CAAY,6BAA6B0B,KAAzC;AACH;AACJ,GAJD;AAKAW,EAAAA,MAAM,CAACM,YAAP,CAAoB,CAApB,EAAuB,UAAUjB,KAAV,EAAiB;AACpC,QAAIA,KAAJ,EAAW;AACP3B,MAAAA,OAAO,CAACC,GAAR,CAAY,2BAA2B0B,KAAvC;AACH;AACJ,GAJD;AAKAW,EAAAA,MAAM,CAACO,wBAAP,CAAgC9C,QAAhC,EAA0C,UAAU4B,KAAV,EAAiB;AACvD,QAAIA,KAAJ,EAAW;AACP3B,MAAAA,OAAO,CAACC,GAAR,CAAY,qCAAqC0B,KAAjD;AACH;AACJ,GAJD;AAMAW,EAAAA,MAAM,CAACO,wBAAP,CAAgC9C,QAAhC,EAA0C,UAAU4B,KAAV,EAAiB;AACvD,QAAIA,KAAJ,EAAW;AACP3B,MAAAA,OAAO,CAACC,GAAR,CAAY,qCAAqC0B,KAAjD;AACH;AACJ,GAJD;AAMA9B,EAAAA,OAAO,GAAG,IAAV;AAEAyC,EAAAA,MAAM,CAACN,kBAAP,CAA0B,UAAUL,KAAV,EAAiB;AACvC3B,IAAAA,OAAO,CAACC,GAAR,CAAY,kCAAmC0B,KAAD,GAAUA,KAAV,GAAkB,EAApD,CAAZ;AACH,GAFD;AAGAW,EAAAA,MAAM,CAACL,eAAP,CAAuB,UAAUN,KAAV,EAAiB;AACpC3B,IAAAA,OAAO,CAACC,GAAR,CAAY,+BAAgC0B,KAAD,GAAUA,KAAV,GAAkB,EAAjD,CAAZ;AACH,GAFD;AAGAW,EAAAA,MAAM,CAACJ,eAAP,CAAuB,UAAUP,KAAV,EAAiB;AACpC3B,IAAAA,OAAO,CAACC,GAAR,CAAY,+BAAgC0B,KAAD,GAAUA,KAAV,GAAkB,EAAjD,CAAZ;AACH,GAFD;AAGAW,EAAAA,MAAM,CAACH,YAAP,CAAoB,UAAUR,KAAV,EAAiB;AACjC3B,IAAAA,OAAO,CAACC,GAAR,CAAY,4BAA6B0B,KAAD,GAAUA,KAAV,GAAkB,EAA9C,CAAZ;AACH,GAFD;AAGAW,EAAAA,MAAM,CAACF,UAAP,CAAkB,UAAUT,KAAV,EAAiB;AAC/B3B,IAAAA,OAAO,CAACC,GAAR,CAAY,0BAA2B0B,KAAD,GAAUA,KAAV,GAAkB,EAA5C,CAAZ;AACH,GAFD;AAGAW,EAAAA,MAAM,CAACQ,aAAP,CAAqB,UAAUnB,KAAV,EAAiB;AAClC3B,IAAAA,OAAO,CAACC,GAAR,CAAY,sBAAuB0B,KAAD,GAAUA,KAAV,GAAkB,EAAxC,CAAZ;AACH,GAFD;AAGAW,EAAAA,MAAM,CAACS,eAAP,CAAuB,UAAUpB,KAAV,EAAiB;AACpC3B,IAAAA,OAAO,CAACC,GAAR,CAAY,6BAA6B0B,KAA7B,GAAqCA,KAArC,GAA6C,EAAzD;AACH,GAFD;AAGAW,EAAAA,MAAM,CAACU,cAAP,CAAsB,UAAUrB,KAAV,EAAiB;AACnC3B,IAAAA,OAAO,CAACC,GAAR,CAAY,4BAA4B0B,KAA5B,GAAoCA,KAApC,GAA4C,EAAxD;AACH,GAFD;AAIAW,EAAAA,MAAM,CAACW,kBAAP,CAA0B,UAAUtB,KAAV,EAAiB;AACvC3B,IAAAA,OAAO,CAACC,GAAR,CAAY,iCAAiC0B,KAAjC,GAAyCA,KAAzC,GAAiD,EAA7D;AACH,GAFD;AAGH;;AAED,IAAMuB,cAAc,GAAG;AACnBC,EAAAA,KAAK,EAAE,eAAUb,MAAV,EAAkB;AACrBD,IAAAA,YAAY,CAACe,IAAb,CAAkBd,MAAlB;AACAD,IAAAA,YAAY,CAACC,MAAD,CAAZ;AACH;AAJkB,CAAvB;AAOAe,MAAM,CAACC,OAAP,GAAiBJ,cAAjB","sourcesContent":["var Thingy = require('thingy52');\nvar insertIntoMongo = require('./mongo');\nvar ref = require('./firebase');\nvar enabled;\nvar data = {};\nvar INTERVAL = 5000;\nconsole.log('Reading Thingy environment sensors!');\n\nfunction onTemperatureData(temperature) {\n    // console.log('Temperature sensor: ' + temperature);\n    data.temperature = temperature;\n    data._id && delete data['_id'];\n    insertIntoMongo(data);\n    const usersRef = ref.push();\n    usersRef.set(data);\n}\n\nfunction onPressureData(pressure) {\n    // console.log('Pressure sensor: ' + pressure);\n    data.pressure = pressure;\n}\n\nfunction onHumidityData(humidity) {\n    // console.log('Humidity sensor: ' + humidity);\n    data.humidity = humidity;\n}\n\nfunction onGasData(gas) {\n    // console.log('Gas sensor: eCO2 ' + gas.eco2 + ' - TVOC ' + gas.tvoc );\n    data.eco2 = gas.eco2;\n    data.tvoc = gas.tvoc;\n}\n\nfunction onColorData(color) {\n    /* console.log('Color sensor: r ' + color.red +\n        ' g ' + color.green +\n        ' b ' + color.blue +\n        ' c ' + color.clear ); */\n    data.color = color;\n}\n\nfunction onRotationNotif(rotation) {\n    data.rotation = rotation;\n}\n\nfunction onStepCounterNotif(steps) {\n    data.steps = steps;\n    console.log('Steps')\n}\n\nfunction onHeadingNotif(heading) {\n    data.heading = heading;\n}\n\nfunction onButtonChange(state) {\n    if (state == 'Pressed') {\n        if (enabled) {\n            enabled = false;\n            this.temperature_disable(function (error) {\n                console.log('Temperature sensor stopped! ' + ((error) ? error : ''));\n            });\n            this.pressure_disable(function (error) {\n                console.log('Pressure sensor stopped! ' + ((error) ? error : ''));\n            });\n            this.humidity_disable(function (error) {\n                console.log('Humidity sensor stopped! ' + ((error) ? error : ''));\n            });\n            this.color_disable(function (error) {\n                console.log('Color sensor stopped! ' + ((error) ? error : ''));\n            });\n            this.gas_disable(function (error) {\n                console.log('Gas sensor stopped! ' + ((error) ? error : ''));\n            });\n        } else {\n            enabled = true;\n            this.temperature_enable(function (error) {\n                console.log('Temperature sensor started! ' + ((error) ? error : ''));\n            });\n            this.pressure_enable(function (error) {\n                console.log('Pressure sensor started! ' + ((error) ? error : ''));\n            });\n            this.humidity_enable(function (error) {\n                console.log('Humidity sensor started! ' + ((error) ? error : ''));\n            });\n            this.color_enable(function (error) {\n                console.log('Color sensor started! ' + ((error) ? error : ''));\n            });\n            this.gas_enable(function (error) {\n                console.log('Gas sensor started! ' + ((error) ? error : ''));\n            });\n        }\n    }\n}\n\nfunction startSensors(thingy) {\n    console.log('Discovered: ' + thingy);\n\n    thingy.on('disconnect', function () {\n        console.log('Disconnected!');\n    });\n\n\n    thingy.on('temperatureNotif', onTemperatureData);\n    thingy.on('pressureNotif', onPressureData);\n    thingy.on('humidityNotif', onHumidityData);\n    thingy.on('gasNotif', onGasData);\n    thingy.on('colorNotif', onColorData);\n    thingy.on('buttonNotif', onButtonChange);\n    thingy.on('rotationNotif', onRotationNotif);\n    thingy.on('stepCounterNotif', onStepCounterNotif);\n    thingy.on('headingNotif', onHeadingNotif);\n\n    thingy.temperature_interval_set(INTERVAL, function (error) {\n        if (error) {\n            console.log('Temperature sensor configure! ' + error);\n        }\n    });\n    thingy.pressure_interval_set(INTERVAL, function (error) {\n        if (error) {\n            console.log('Pressure sensor configure! ' + error);\n        }\n    });\n    thingy.humidity_interval_set(INTERVAL, function (error) {\n        if (error) {\n            console.log('Humidity sensor configure! ' + error);\n        }\n    });\n    thingy.color_interval_set(INTERVAL, function (error) {\n        if (error) {\n            console.log('Color sensor configure! ' + error);\n        }\n    });\n    thingy.gas_mode_set(1, function (error) {\n        if (error) {\n            console.log('Gas sensor configure! ' + error);\n        }\n    });\n    thingy.stepCounter_interval_set(INTERVAL, function (error) {\n        if (error) {\n            console.log('Step interval sensor configure! ' + error);\n        }\n    });\n\n    thingy.stepCounter_interval_set(INTERVAL, function (error) {\n        if (error) {\n            console.log('Step interval sensor configure! ' + error);\n        }\n    });\n\n    enabled = true;\n\n    thingy.temperature_enable(function (error) {\n        console.log('Temperature sensor started! ' + ((error) ? error : ''));\n    });\n    thingy.pressure_enable(function (error) {\n        console.log('Pressure sensor started! ' + ((error) ? error : ''));\n    });\n    thingy.humidity_enable(function (error) {\n        console.log('Humidity sensor started! ' + ((error) ? error : ''));\n    });\n    thingy.color_enable(function (error) {\n        console.log('Color sensor started! ' + ((error) ? error : ''));\n    });\n    thingy.gas_enable(function (error) {\n        console.log('Gas sensor started! ' + ((error) ? error : ''));\n    });\n    thingy.button_enable(function (error) {\n        console.log('Button started! ' + ((error) ? error : ''));\n    });\n    thingy.rotation_enable(function (error) {\n        console.log('Rotation sensor started ' + error ? error : '');\n    });\n    thingy.heading_enable(function (error) {\n        console.log('Heading sensor started ' + error ? error : '');\n    });\n\n    thingy.stepCounter_enable(function (error) {\n        console.log('Step counter sensor started ' + error ? error : '');\n    });\n}\n\nconst thingyServices = {\n    start: function (thingy) {\n        startSensors.bind(thingy);\n        startSensors(thingy)\n    }\n};\n\nmodule.exports = thingyServices;\n\n\n"],"file":"index.js"}